/**
 * iOS In-App Purchase Configuration for WhatsCard
 *
 * App Store Connect Credentials and Configuration
 *
 * âš ï¸ SECURITY WARNING:
 * This file contains sensitive credentials. Never commit to public repositories.
 * Add to .gitignore and use environment variables in production.
 */

export const IOS_IAP_CONFIG = {
  /**
   * App Store Connect Information
   */
  appStoreConnect: {
    appId: '6754809694',
    bundleId: 'com.whatscard.app',
    sku: 'WHATSCARD300K',
  },

  /**
   * Subscription Group
   */
  subscriptionGroup: {
    name: 'Premium Subscriptions',
    id: '21832389',
  },

  /**
   * Product IDs and Apple IDs
   *
   * âš ï¸ CRITICAL WARNING - THESE PRODUCT IDs ARE IMMUTABLE! âš ï¸
   * These IDs are permanently registered in App Store Connect.
   * Once created, they CANNOT be changed, deleted, or renamed.
   * Changing them will break the app for all existing users!
   *
   * ðŸ”’ DOCUMENTED IN: CLAUDE.md - NEVER MODIFY! ðŸ”’
   */
  products: {
    monthly: {
      productId: 'whatscard_monthly_premium',  // âŒ IMMUTABLE
      appleId: '6755295183',
      price: 9.99,
      displayPrice: '$9.99',
      period: 'P1M', // 1 month
      title: 'WhatsCard Premium Monthly',
      description: 'Perfect for trying out',
    },
    yearly: {
      productId: 'whatscard_yearly_premium',  // âŒ IMMUTABLE
      appleId: '6755295624',
      price: 119.99,
      displayPrice: '$119.99',
      period: 'P1Y', // 1 year
      title: 'WhatsCard Premium Yearly - Best Value!',
      description: 'Best value - Save 20%',
      badge: 'BEST VALUE',
    },
  },

  /**
   * Shared Secret for Receipt Validation
   *
   * âš ï¸ CRITICAL: Used for server-side receipt verification
   * SECURITY: This secret is now loaded from environment variables
   *
   * The value below is a fallback for development only.
   * In production, you MUST set IOS_APP_STORE_SHARED_SECRET in your environment.
   */
  sharedSecret: process.env.IOS_APP_STORE_SHARED_SECRET || '',

  /**
   * Promotional Offer Configuration
   *
   * Note: Promotional offers require additional setup in App Store Connect:
   * 1. Create subscription offer code
   * 2. Generate subscription key
   * 3. Configure offer with code and discount
   */
  promotionalOffers: {
    WHATSBNI: {
      offerCode: 'WHATSBNI',
      discount: 0.70, // 70% off
      applicableTo: 'whatscard_yearly_premium',
      discountedPrice: 36.00, // $119.99 * 0.30
      description: '70% off yearly subscription',
      // Note: Offer ID and signature will be generated by App Store Connect
    },
  },

  /**
   * Sandbox Testing
   */
  sandbox: {
    enabled: __DEV__, // Auto-detect dev mode
    testAccountRequired: true,
  },

  /**
   * Receipt Validation
   */
  receiptValidation: {
    productionUrl: 'https://buy.itunes.apple.com/verifyReceipt',
    sandboxUrl: 'https://sandbox.itunes.apple.com/verifyReceipt',
  },
} as const;

/**
 * Helper function to get product by plan type
 */
export const getIOSProduct = (plan: 'monthly' | 'yearly') => {
  return IOS_IAP_CONFIG.products[plan];
};

/**
 * Helper function to get all product IDs
 */
export const getIOSProductIds = (): string[] => {
  return [
    IOS_IAP_CONFIG.products.monthly.productId,
    IOS_IAP_CONFIG.products.yearly.productId,
  ];
};

console.log('[iOS IAP Config] âœ… Configuration loaded');
console.log(`[iOS IAP Config] App ID: ${IOS_IAP_CONFIG.appStoreConnect.appId}`);
console.log(`[iOS IAP Config] Bundle ID: ${IOS_IAP_CONFIG.appStoreConnect.bundleId}`);
